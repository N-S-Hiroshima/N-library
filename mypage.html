<!DOCTYPE html>
<html lang="ja">

<head>
    <title>マイページ</title>
    
    <!--CSS-->
    <link rel="stylesheet" href="./css/mypage.css">
    <!--外部JS-->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <!--自作JS-->
    <script src="./js/google-login.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/jquery-barcode.js"></script>


</head>

<body>
    <header>
        <script src="./js/header.js"></script>
        <script>header();</script>
    </header>
 <div class="mypage-frame flex">
        <div class="frame_left">
            <div id="icom"></div>
            <div class="tab-mypage">
                <input id="profile" type="button" class="tab-mypage_item is-active"  value=" プロフィール " onclick="change()"/></input>
                <input id="history" type="button" class="tab-mypage_item"  value="借りた本の履歴" onclick="change()"></input>
                <input id="return" type="button" class="tab-mypage_item"  value="返却日が近い本" onclick="change()"></input>
                <input id="reserve" type="button" class="tab-mypage_item"  value="予約した本" onclick="change()"></input>
            </div>
        </div>
        <div class="frame_right">
            <div class="tab_mypage-content" id="content-01">
                <div id="name"></div>
                <div id="mail"></div>
                <div id="bcTarget"></div>
                <div id="datas"></div>
                <a href="https://myaccount.google.com/" class="acount-google">編集</a>
            </div>
            <div class="tab_mypage-content" id="content-02">
                <p>仮置き</p>
            </div>
            <div class="tab_mypage-content" id="content-03">
                <p>仮置きに</p>
            </div>
            <div class="tab_mypage-content"  id="content-04">
                <p>仮置き3</p>
            </div>
        </div>
         <!-- <div id="tables">
             <table id="foo-table" class="table table-bordered">
                 <thead>
                     <tr>
                         <th>本</th>
                         <th>状態</th>
                         <th>最終更新日</th>
                         <th class="sys-no">処理番号</th>
                     </tr>
                 </thead>
                 <tbody>
     
                     <tr>
                     </tr>
                 </tbody>
             </table>
         </div> -->
 </div>
    <script>
        //ログイン情報取得
        const logindata = cheak() //データ取得
        document.getElementById("name").innerHTML = logindata.name 
        document.getElementById("mail").innerHTML = logindata.email
        document.getElementById("icom").innerHTML = `<img src="${logindata.picture}">`
        //バーコード表示
        $("#bcTarget").barcode(logindata.sub, "code39", { barWidth: 2.9, barHeight: 90 });

        // タブ切り替え
        function change(e) {
            var e = e || window.event;
            var elem = e.target || e.srcElement;
            var elemId = elem.id;
            var content01 = document.getElementById('content-01')
            var content02 = document.getElementById('content-02')
            var content03 = document.getElementById('content-03')
            var content04 = document.getElementById('content-04')
            switch (elemId) {
                case 'profile' :
                    content01.classList.add('is-show')
                    content02.classList.remove('is-show')
                    content03.classList.remove('is-show')
                    content04.classList.remove('is-show')
                    break;
                case 'history':
                    content01.classList.remove('is-show')
                    content02.classList.add('is-show')
                    content03.classList.remove('is-show')
                    content04.classList.remove('is-show')
                    break;
                case 'return':
                    content01.classList.remove('is-show')
                    content02.classList.remove('is-show')
                    content03.classList.add('is-show')
                    content04.classList.remove('is-show')
                    break;
                case 'reserve':
                    content01.classList.remove('is-show')
                    content02.classList.remove('is-show')
                    content03.classList.remove('is-show')
                    content04.classList.add('is-show')
                    break;
            }
            
        }

        //貸出予約履歴照会
        send("LendingData",logindata.sub);

        //api.jsからの呼び出し（データが返ってきたら）
        function mydata(datas) {
            const table = document.getElementById('foo-table');  //表のオブジェクトを取得
            for (let i = 0; i < datas.length; i++) {
                if (logindata.sub == datas[i][0]) {
                    var row = table.insertRow(-1);  //行末に行(tr要素)を追加
                     //セル(td要素)の追加
                    for(let i=0;i<4;i++){
                        eval(`var cell${i}= row.insertCell(${i})`)
                    }
                    
                    cell0.innerHTML = `<div><img src="${datas[i][8]}"></div><div>${datas[i][7]}</div>${datas[i][1]}`
                    cell1.innerHTML = datas[i][5]

                    if (datas[i][5] == "返却済み") {
                        cell2.innerHTML = `${datas[i][4].substr(0, 4)} / ${datas[i][4].substr(5, 2)} / ${datas[i][4].substr(8, 2)} <br> ${datas[i][4].substr(11, 8)}`
                    } else if (datas[i][5] == "貸出中") {
                        cell2.innerHTML = `${datas[i][3].substr(0, 4)} / ${datas[i][3].substr(5, 2)} / ${datas[i][3].substr(8, 2)} <br> ${datas[i][3].substr(11, 8)}`
                    } else if (datas[i][5] == "予約中") {
                        cell2.innerHTML = `${datas[i][2].substr(0, 4)} / ${datas[i][2].substr(5, 2)} / ${datas[i][2].substr(8, 2)} <br> ${datas[i][2].substr(11, 8)}`
                    }
                    cell3.innerHTML =`<div class="sys-no">${datas[i][6]}</div>`
                }
            }
        }

    </script>
</body>

</html>